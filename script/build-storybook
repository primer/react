#!/bin/bash
set -e

cd packages/react

# Add base url to be able to serve static files
if [ -n "$1" ]; then
  echo '<base href="/storybook/" />' >> .storybook/manager-head.html
else
  echo '<base href="/react/storybook/" />' >> .storybook/manager-head.html
fi

# Build storybook inside docs
npx storybook build -o ../../docs/public/storybook

if [ "$1" == "preview_with_reports" ]; then
  # Move index_with_reports.html to the right location
  cp .storybook/index_with_reports.html ../../docs/public/index.html
else
  # Move index.html to the right location
  cp .storybook/index.html ../../docs/public/index.html
fi

# Remove manager-head after build to not interfere with dev builds
rm .storybook/manager-head.html
rm .storybook/index.html
rm .storybook/index_with_reports.html
